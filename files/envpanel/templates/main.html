<!--
  Copyright(c) 2017 Radek Kaczorek  <rkaczorek AT gmail DOT com>
  Copyright(c) 2021 Jens Scheidtmann <Jens DOT Scheidtmann AT gmail DOT com>

 This library is free software; you can redistribute it and/or
 modify it under the terms of the GNU Library General Public
 License version 2 as published by the Free Software Foundation.

 This library is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 Library General Public License for more details.

 You should have received a copy of the GNU Library General Public License
 along with this library; see the file COPYING.LIB.  If not, write to
 the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 Boston, MA 02110-1301, USA.
-->

<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<meta http-equiv="Content-Language" content="en,en-us"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health &amp; Environment</title>
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="assets/css/style.css" rel="stylesheet">
    <script src="assets/js/jquery-3.4.1.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/socket.io.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
	var url = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port: '');
	var socket = io.connect(url, { path: location.pathname + 'socket.io' });
	socket.on('environdata', function(env) {
			$("#powervolts").html(env.v);
			$("#powercurrent").html(env.c);
			$("#powerpower").html(env.pow);
			$("#envtemp").html(env.t);
			$("#envpressure").html(env.p);
			$("#envhumidity").html(env.h);
			$("#raspicpu").html(env.cpu_percent);
			$("#raspimem").html(env.mem_percent);
			$("#raspidisk").html(env.disk_percent);
			$("#raspiload").html(env.loadvals);
			$("#raspicputemp").html(env.cputempval);

			if (env.voltage) {
				$("#powvoltage").attr("src", "data:image/png;base64," + env.voltage);
			}

			if (env.current) {
				$("#powcurrent").attr("src", "data:image/png;base64," + env.current);
			}

			if (env.power) {
				$("#powpower").attr("src", "data:image/png;base64," + env.power);
			}

			if (env.temperature) {
				$("#temperature").attr("src", "data:image/png;base64," + env.temperature);
			}

			if (env.pressure) {
				$("#pressure").attr("src", "data:image/png;base64," + env.pressure);
			}

			if (env.humidity) {
				$("#humidity").attr("src", "data:image/png;base64," + env.humidity);
			}

			if (env.percents) {
				$("#raspipercentages").attr("src", "data:image/png;base64," + env.percents);
			}

			if (env.loads) {
				$("#raspiloads").attr("src", "data:image/png;base64," + env.loads);
			}

			if (env.cputemp) {
				$("#cputemp").attr("src", "data:image/png;base64," + env.cputemp);
			}
		});
	});
    </script>
</head>
<body onload="toggleraspi()">
	<div class="panel_container">
		<h1>Environment Information</span></h1>
		<div id="displayctl">
			<button id="toggleraspi" onclick="toggleraspi();">Raspberry Pi</button>
			<button id="togglepower" onclick="togglepower();">Power</button>
			<button id="toggleenv" onclick="toggleenviron();">Environment</button>
		</div>
		<div id="power">
			<div id="powerdisplay">
				<table>
					<tr>
						<td class="powerdata"><span id="powervolts"></span></td>
						<td class="powerdata"><span id="powercurrent"></span></td>
						<td class="powerdata"><span id="powerpower"></span></td>
					</tr>
				</table>	
			</div>
			<div><img class="graph" id="powvoltage" src="assets/img/power.png"/></div>
			<div><img class="graph" id="powcurrent" src="assets/img/power.png"/></div>
			<div><img class="graph" id="powpower" src="assets/img/power.png"/></div>
		</div>
		<div id="environment">
			<div id="environmentdisplay">
				<table>
				<tr><td class="envhdr">Temperature:</td><td class="envvalue"><span id="envtemp"></span></td></tr>
				<tr><td class="envhdr">Pressure:</td><td class="envvalue"><span id="envpressure"></span></td></tr>
				<tr><td class="envhdr">Humidity:</td><td class="envvalue"><span id="envhumidity"></span></td></tr>
				</table>
			</div>
			<div><img class="graph" id="temperature" src="assets/img/environment.png" /></div>
			<div><img class="graph" id="pressure" src="assets/img/environment.png" /></div>
			<div><img class="graph" id="humidity" src="assets/img/environment.png" /></div>
		</div>
		<div id="raspi">
			<div id="raspidisplay">
				<table>
					<tr><td class="raspihdr">CPU:</td><td class="raspivalue"><span id="raspicpu"></span></td></tr>
					<tr><td class="raspihdr">Memory:</td><td class="raspivalue"><span id="raspimem"></span></td></tr>
					<tr><td class="raspihdr">Disk:</td><td class="raspivalue"><span id="raspidisk"></span></td></tr>
					<tr><td class="raspihdr">Load avg.:</td><td class="raspivalue"><span id="raspiload"></span></td></tr>
					<tr><td class="raspihdr">CPU Temp:</td><td class="raspivalue"><span id="raspicputemp"></span></td></tr>
				</table>
			</div>
			<div><img class="graph" id="raspipercentages" src="assets/img/raspi.png"/></div>
			<div><img class="graph" id="raspiloads" src="assets/img/raspi.png"/></div>
			<div><img class="graph" id="cputemp" src="assets/img/raspi.png"/></div>
		</div>
	</div>
	<script type="text/javascript">
	function toggleenviron() {
			document.getElementById("environment").style.display="block";
			document.getElementById("power").style.display="none";
			document.getElementById("raspi").style.display="none";
	}
	function togglepower() {
			document.getElementById("environment").style.display="none";
			document.getElementById("power").style.display="block";
			document.getElementById("raspi").style.display="none";
	}
	function toggleraspi() {
			document.getElementById("environment").style.display="none";
			document.getElementById("power").style.display="none";
			document.getElementById("raspi").style.display="block";
	}
	</script>
</body>
</html>